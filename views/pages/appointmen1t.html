<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Appointment â€” Elite Travel & Tour</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="Schedule a consultation with Elite Travel & Tour: visa, Work & Pay, and flight booking services."/>
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/layout.css">
  <link rel="stylesheet" href="/css/components.css">
  <link rel="stylesheet" href="/css/pages.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- Standard ICO -->
<link rel="icon" href="/favicon.ico" type="image/x-icon">

<!-- Or PNG -->
<link rel="icon" href="/favicon.png" type="image/png">

<!-- Optional: SVG -->
<link rel="icon" href="/favicon.svg" type="image/svg+xml">

  <style>
    :root{
      --brand:#0077cc;
      --brand-600:#0060a3;
      --brand-700:#004b80;
      --dark:#222;
      --light:#fff;
      --muted:#666;
      --bg:#f7f8fa;
      --gray-200:#e9ecef;
      --gray-300:#dee2e6;
      --shadow:0 8px 24px rgba(0,0,0,.08);
      --radius:12px;
      --success:#2e7d32;
      --danger:#c62828;
    }
    body { background:var(--bg); color:#222; }
    .container { max-width:1100px; margin:0 auto; padding:1rem; }
    .grid { display:block; }

    /* Card and inputs */
    .card { background:#fff; border:1px solid var(--gray-200); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden; }
    .card .body { padding:1rem; }
    .page-title { font-size:1.8rem; margin-bottom:.75rem; }
    .muted { color:var(--muted); }
    .list { display:block; }

    /* Form */
    .form-grid { display:grid; gap:1rem; grid-template-columns:1fr 1fr; }
    .form-grid .input,
    .form-grid .select,
    .form-grid .textarea {
      width:100%; padding:.7rem .8rem; border:1px solid var(--gray-300); border-radius:10px; font-size:1rem; background:#fff;
    }
    .form-grid .textarea { min-height:120px; grid-column:1 / -1; }
    .form-grid .full { grid-column:1 / -1; }
    .form-grid .actions { grid-column:1 / -1; display:flex; gap:.5rem; flex-wrap:wrap; align-items:center; }
    .hint { font-size:.9rem; color:#555; }
    .success { color:var(--success); }
    .error { color:var(--danger); }

    /* Modal */
    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:1000; }
    .modal .card { max-width:480px; width:92%; }

    /* Toast */
    .toast {
      position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
      background:#1b2a3a; color:#eaf4ff; padding:.75rem 1rem; border-radius:8px;
      box-shadow:var(--shadow); z-index:2000; display:none; max-width:90vw;
    }
    .toast.show { display:flex; align-items:center; gap:.6rem; }
    .toast i { color:#4fc3f7; }

    /* Responsive */
    @media (max-width:700px){
      .form-grid { grid-template-columns:1fr; }
    }
  </style>
</head>
<body>
  
  <!-- Shared header will be injected here -->
  <div id="header"></div>

  <main class="container grid">
    <section class="card"><div class="body list">
      <h2 class="page-title">Book Appointment</h2>
      <p class="muted">Consultations for visa assistance, Work & Pay, and flight bookings. Logged-in users can schedule directly.</p>

      <!-- Appointment Form -->
      <form id="appointmentForm" class="form-grid" action="https://formsubmit.co/billphamous@gmail.com" method="POST" novalidate>
        <input class="input" type="text" name="name" placeholder="Full name" autocomplete="name" required>
        <input class="input" type="email" name="email" placeholder="Email" autocomplete="email" required>

        <input class="input" type="date" name="date" required>
        <input class="input" type="time" name="time" required>

        <select class="select" name="service" required>
          <option value="">Select service</option>
          <option value="visa">Visa consultation</option>
          <option value="work">Work & Pay consultation</option>
          <option value="flight">Flight booking consultation</option>
          <option value="express">Express travel service</option>
        </select>

        <input class="input full" type="text" name="job" id="jobParam" placeholder="Job reference (auto-filled if you came from Jobs)">

        <textarea class="textarea" name="notes" placeholder="Additional notes (optional)"></textarea>

        <!-- Hidden fields for tracking -->
        <input type="hidden" name="source" id="sourceField" value="appointment-page">
        <input type="hidden" name="ts" id="tsField" value="">

        <div class="actions">
          <button id="scheduleBtn" type="submit" class="btn brand"><i class="fa fa-calendar"></i> Schedule</button>
          <span id="gateHint" class="hint"></span>
        </div>
      </form>

      <div id="statusMsg" class="muted" style="margin-top:.5rem"></div>
    </div></section>
  </main>

  <!-- Shared footer will be injected here -->
  <div id="footer"></div>

  <!-- Confirmation Modal -->
  <div class="modal" id="confirmModal" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
    <section class="card"><div class="body">
      <h3 id="confirmTitle">Appointment Scheduled</h3>
      <p id="confirmText"></p>
      <div class="toolbar">
        <button class="btn brand" id="confirmOk"><i class="fa fa-check"></i> OK</button>
      </div>
    </div></section>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"><i class="fa fa-info-circle"></i><span id="toastText">Notice</span></div>

  <script type="module">
    import { mountShell } from '/src/js/ui.js';
    mountShell();

    /* Appointment form behavior */
    const form = document.getElementById('appointmentForm');
    const confirmModal = document.getElementById('confirmModal');
    const confirmText = document.getElementById('confirmText');
    const confirmOk = document.getElementById('confirmOk');
    const statusMsg = document.getElementById('statusMsg');
    const jobParamField = document.getElementById('jobParam');
    const sourceField = document.getElementById('sourceField');
    const tsField = document.getElementById('tsField');

    // Prefill from URL params (job, service, date)
    const params = new URLSearchParams(location.search);
    const jobParam = params.get('job');
    const serviceParam = params.get('service');
    const dateParam = params.get('date');
    if (jobParam) { jobParamField.value = jobParam; }
    if (serviceParam) {
      const sel = form.querySelector('select[name="service"]');
      const opt = [...sel.options].find(o => o.value === serviceParam);
      if (opt) sel.value = serviceParam;
    }
    if (dateParam) {
      const dateInput = form.querySelector('input[name="date"]');
      dateInput.value = dateParam;
    }

    // Timestamp and source
    tsField.value = String(Date.now());
    sourceField.value = document.referrer ? 'ref:'+new URL(document.referrer).pathname : 'appointment-page';

    // Submit flow
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();

      // Basic validation
      const name = form.elements['name'].value.trim();
      const email = form.elements['email'].value.trim();
      const date = form.elements['date'].value;
      const time = form.elements['time'].value;
      const service = form.elements['service'].value;

      if (!name || !email || !date || !time || !service) {
        showToast('Please complete all required fields');
        return;
      }

            statusMsg.textContent = 'Submitting...';
      const formData = new FormData(form);

      try {
        // Send to FormSubmit (generic API endpoint)
        await fetch(form.action, { method:"POST", body:formData });

        // Confirmation modal
        confirmText.textContent = `Thank you ${name}, your ${service} appointment is scheduled for ${date} at ${time}. A confirmation will be sent to ${email}.`;
        confirmModal.style.display = 'flex';
        statusMsg.textContent = '';
        form.reset();

        // Preserve job param display after reset
        if (jobParam) jobParamField.value = jobParam;
      } catch (err) {
        statusMsg.textContent = '';
        showToast('Submission failed. Please try again.');
      }
    });

    confirmOk.addEventListener('click', ()=> {
      confirmModal.style.display = 'none';
    });

    // Close modal on backdrop click
    confirmModal.addEventListener('click', (e)=>{
      if (e.target === confirmModal) confirmModal.style.display = 'none';
    });

    // Toast helper
    const toast = document.getElementById('toast');
    const toastText = document.getElementById('toastText');
    function showToast(message, ms=2500){
      toastText.textContent = message;
      toast.classList.add('show');
      setTimeout(()=> toast.classList.remove('show'), ms);
    }
  </script>
</body>
</html>
