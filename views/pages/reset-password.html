<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Reset Password — Elite Travel & Tour</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="Reset password for Elite Travel & Tour"/>
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/components.css">
  <link rel="stylesheet" href="/css/index.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script type="module" src="/src/js/supabase.js"></script>
  <!-- Standard ICO -->
<link rel="icon" href="/favicon.ico" type="image/x-icon">

<!-- Or PNG -->
<link rel="icon" href="/favicon.png" type="image/png">

<!-- Optional: SVG -->
<link rel="icon" href="/favicon.svg" type="image/svg+xml">
<style>
   
    /* Header / Footer */
    .site-header, .site-footer{ background:#fff; }
    .site-header{ border-bottom:1px solid var(--gray-200); }
    .site-footer{ border-top:1px solid var(--gray-200); text-align:center; font-size:.9rem; color:var(--muted); }
    .site-header .bar, .site-footer .bar{ display:flex; align-items:center; justify-content:space-between; gap:.75rem; padding:.75rem 1rem; }
    .site-header nav a, .site-footer nav a{ margin:0 .5rem; color:var(--brand); text-decoration:none; font-weight:700; }
    .site-header nav a:hover, .site-footer nav a:hover{ text-decoration:underline; }
    .logo{ display:flex; align-items:center; gap:.5rem; }
    .logo img{ height:40px; width:auto; border-radius:6px; }

    /* Page content */
    .page-wrap{ max-width:720px; margin:2rem auto; }
    .page-title{ margin:.25rem 0 .75rem; text-align:center; }
    .hint{ font-size:.95rem; color:#555; text-align:center; }

    .form-grid{ display:grid; gap:1rem; max-width:420px; margin:1rem auto 0 auto; }
    .input, .btn{ border-radius:10px; }
    .btn{ display:inline-flex; align-items:center; gap:.45rem; border:none; padding:.5rem .85rem; cursor:pointer; font-weight:700; }
    .btn.brand{ background:var(--brand); color:#fff; }
    .btn.brand:hover{ background:var(--brand-600); }
    .btn.outline{ background:#fff; border:1px solid var(--gray-300); color:#222; }
    .btn.outline:hover{ border-color:var(--brand); color:var(--brand); }

    .alert{ margin-top:.75rem; padding:.6rem .75rem; border-radius:10px; border:1px solid var(--gray-300); background:#fff; }
    .alert.success{ border-color:#bde5cb; background:#e7f7ee; color:#155724; }
    .alert.danger{ border-color:#f4c7c8; background:#fdecec; color:#8a1c1d; }
    .alert.info{ border-color:#cfe6ff; background:#f2f8ff; color:#0a4d7a; }

    
    /* Tips list */
    .tips{ margin-top:1rem; }
    .tips ul{ list-style:none; padding:0; margin:0; display:grid; gap:.5rem; }
    .tips li{ display:flex; align-items:flex-start; gap:.5rem; color:#444; }
    .tips i{ color:var(--brand); margin-top:.15rem; }

    /* Footer small print */
    .small-print{ font-size:.85rem; color:#777; margin-top:.5rem; }
  </style>
</head>
<body>

  <nav aria-label="Primary">
  <div class="wrap">
    <a class="logo" href="/"><img src="/assets/logo/logo.png" alt="Elite Travel & Tour"></a>
    <ul class="primary">
      <li><a href="/views/pages/index.html"><i class="fa fa-house"></i> Home</a></li>
      <li><a href="/views/pages/services.html"><i class="fa fa-suitcase"></i> Services</a></li>
      <li><a href="/views/pages/work-and-pay.html"><i class="fa fa-briefcase"></i> Work & Pay</a></li>
      <li><a href="/views/pages/appointment.html" ><i class="fa fa-calendar"></i> Book</a></li>
      <li><a href="/views/pages/contact.html"><i class="fa fa-envelope"></i> Contact</a></li>
      <li><a href="/views/pages/about.html"><i class="fa fa-circle-info"></i> About</a></li>
    </ul>
    <div class="nav-right">
      <button id="bellBtn" class="btn outline bell" aria-label="Notifications">
        <i class="fa-regular fa-bell"></i>
        <span id="bellCount" class="count hidden">0</span>
      </button>
      <span id="authStatus" class="auth-pill" style="display:none;">
        <i class="fa fa-user-check"></i><span class="auth-text">Guest</span>
      </span>
      <button id="loginBtn" class="btn outline"><i class="fa fa-right-to-bracket"></i> Login</button>
      <button id="profileBtn" class="btn outline" style="display:none"><i class="fa fa-user"></i> </button>
      <button id="logoutBtn" class="btn outline" style="display:none"><i class="fa fa-right-from-bracket"></i> Logout</button>
      <button id="menuToggle" class="menu-toggle" aria-expanded="false"><i class="fa fa-bars"></i></button>
    </div>
  </div>

  <!-- Mobile panel -->
  <div id="mobilePanel" class="mobile-panel">
    <div class="block">
      <a href="/views/pages/index.html"><i class="fa fa-house"></i> Home</a>
      <a href="/views/pages/services.html"><i class="fa fa-suitcase"></i> Services</a>
      <a href="/views/pages/work-and-pay.html"><i class="fa fa-briefcase"></i> Work & Pay</a>
      <a href="/views/pages/appointment.html" ><i class="fa fa-calendar"></i> Book</a>
      <a href="/views/pages/contact.html"><i class="fa fa-envelope"></i> Contact</a>
      <a href="/views/pages/about.html"><i class="fa fa-circle-info"></i> About</a>
    </div>
    <div class="block">
      <span class="auth-pill"><i class="fa fa-user"></i><span id="mobileAuthText">Guest</span></span>
      <div class="toolbar">
        <button id="mobileLoginBtn" class="btn brand"><i class="fa fa-right-to-bracket"></i> Login</button>
        <button id="mobileProfileBtn" class="btn outline" style="display:none"><i class="fa fa-user">Profile</i> </button>
        <button id="mobileLogoutBtn" class="btn outline" style="display:none"><i class="fa fa-right-from-bracket"></i> Logout</button>
      </div>
    </div>
  </div>
</nav>

 <div id="notifFeed" class="feed hidden">
  <div class="feed-toolbar">
    <span class="muted small-text">Notifications</span>
    <div style="color:var(--brand);display:flex;gap:.25rem;">
      <button id="markAllReadBtn" class='btn ' style="color:var(--brand);" ><i class="fa fa-check-double"></i> Mark as Read</button>
      <button id="clearAllNotifBtn" class='btn '><i class="fa fa-trash"></i> Clear</button>
    </div>
  </div>
  <div id="notifList" class="list"></div>
</div>
<script type="module" src="/src/js/notifications.js"></script>

  <!-- Content -->
  <div class="container page-wrap">
    <section class="card">
      <div class="body">
        <h2 class="page-title">Reset Password</h2>
        <p class="hint">Enter your email address and we’ll send you a secure reset link.</p>

        <form id="resetForm" class="form-grid" novalidate>
          <input class="input" type="email" id="resetEmail" placeholder="Email address" autocomplete="email" required aria-label="Email address">
          <button type="submit" class="btn brand" id="sendBtn"><i class="fa fa-key"></i> Send Reset Link</button>
          <div id="statusMsg" class="alert info" role="status" aria-live="polite" style="display:none;"></div>
        </form>

        <div class="tips">
          <h4 class="section-title">Tips</h4>
          <ul>
            <li><i class="fa fa-lock"></i><span>Use your registered email to receive the reset link.</span></li>
            <li><i class="fa fa-shield-halved"></i><span>For security, the link expires after a short period.</span></li>
            <li><i class="fa fa-envelope"></i><span>Check your spam folder if you don’t see the email.</span></li>
          </ul>
        </div>

        <div class="small-print">If you continue having issues, contact support at <a href="mailto:support@elitetravel.com">support@elitetravel.com</a>.</div>
      </div>
    </section>
  </div>

  <!-- Footer -->
  <footer id="footer">
    <div class="grid">
      <div>
        <h4>Elite Travel & Tour</h4>
        <p>Trusted partner for seamless journeys worldwide.</p>
        <p class="muted">Visa assistance, Work & Pay programs, and flight bookings with premium support.</p>
      </div>
      <div>
        <h4>Quick Links</h4>
        <ul>
          <li><a href="/views/pages/services.html">Services</a></li>
          <li><a href="/views/pages/work-and-pay.html">Work & Pay</a></li>
          <li><a href="/views/pages/appointment.html">Book Appointment</a></li>
          <li><a href="/views/pages/contact.html">Contact</a></li>
          <li><a href="/views/pages/about.html">About</a></li>
        </ul>
      </div>
      <div>
        <h4>Contact</h4>
        <p><i class="fa fa-phone"></i> +233 59 911 7007</p>
        <p><i class="fa fa-envelope"></i> info@elitetravel.com</p>
        <p><i class="fa fa-map-marker-alt"></i> Adabraka Akasanoma rd, Greater Accra, Ghana</p>
        <!-- Newsletter -->
      <div class="newsletter">
        <label for="newsletterEmail" class="muted">Subscribe to our newsletter:</label><br>
        <input id="newsletterEmail" type="email" placeholder="Your email">
        <button id="subscribeBtn"><i class="fa fa-paper-plane"></i> Subscribe</button>
      </div>
      <div id="subscribeMsg" class="muted" style="margin-top:.5rem;"></div>
      </div>
      <div>
      <h4>Resources</h4>
      <ul class="list">
        <li><a href="/views/pages/profile.html">Profile</a></li>
        <li><a href="/views/pages/tracking.html">Tracking</a></li>
        <li><a href="/views/pages/privacy.html">Privacy Policy</a></li>
        <li><a href="/views/pages/terms.html">Terms of Service</a></li>
      </ul>
    </div>
      <div class="social">
        <h4>Follow Us</h4>
        <div class="toolbar">
          <a href="#"><i class="fa-brands fa-facebook"></i></a>
          <a href="#"><i class="fa-brands fa-x-twitter"></i></a>
          <a href="#"><i class="fa-brands fa-instagram"></i></a>
          <a href="#"><i class="fa-brands fa-linkedin"></i></a>
        </div>
      </div>
    </div>
    
  <!-- Footer bottom -->
  <div class="footer-bottom">© <span id="year"></span> Elite Travel & Tour. All rights reserved.</div>
  </footer>

  
  <!-- <script>
    // Dynamic year
    document.getElementById('year').textContent=new Date().getFullYear();

    // Newsletter subscription demo
    const subscribeBtn=document.getElementById('subscribeBtn');
    const eemailInput=document.getElementById('newsletterEmail');
    const subscribeMsg=document.getElementById('subscribeMsg');
    subscribeBtn.addEventListener('click',()=>{
      const eemail=eemailInput.value.trim();
      if(!eemail){ subscribeMsg.textContent="Please enter your email."; subscribeMsg.style.color="red"; return; }
      subscribeMsg.textContent=`Thank you for subscribing, ${eemail}!`;
      subscribeMsg.style.color="lightgreen";
      eemailInput.value="";
    });
  </script> -->

  <!-- Confirmation Modal -->
  <div class="modal" id="confirmModal" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
    <section class="card"><div class="body">
      <h3 id="confirmTitle">Password Reset Requested</h3>
      <p id="confirmText"></p>
      <div class="toolbar" style="display:flex;gap:.5rem;justify-content:flex-end;">
        <button class="btn outline" id="closeModal"><i class="fa fa-xmark"></i> Close</button>
        <button class="btn brand" id="openMail"><i class="fa fa-envelope-open-text"></i> Open Mail</button>
      </div>
    </div></section>
  </div>

  
    <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"><i class="fa fa-info-circle"></i><span id="toastText">Notice</span></div>

  
 <script type="module">
  import { sb } from '/src/js/supabase.js';

// --- Notification feed toggle
  document.addEventListener('click',(e)=>{
    const feed=document.getElementById('notifFeed');
    if(!feed) return;
    if(e.target.closest('#bellBtn')){ feed.classList.toggle('hidden'); }
    else if(!e.target.closest('#notifFeed')){ feed.classList.add('hidden'); }
  });

  
  // --- Supabase notifications subscription
  function renderNotification(n){
    const list=document.getElementById('notifList');
    const bellCount=document.getElementById('bellCount');
    if(list){
      const el=document.createElement('div');
      el.className='item';
      el.textContent=n.message || n.text;
      list.prepend(el);
    }
    if(bellCount){
      const count=parseInt(bellCount.textContent||'0',10)+1;
      bellCount.textContent=String(count);
      bellCount.classList.remove('hidden');
    }
  }

  let channel;
  async function subscribeNotifications(userId){
    if(channel){ await sb.removeChannel(channel); channel=null; }
    channel=sb.channel(`header-notifs-${userId}`)
      .on('postgres_changes',{
        event:'INSERT',
        schema:'public',
        table:'notifications',
        filter:`user_id=eq.${userId}`
      },payload=>{
        renderNotification(payload.new);
      })
      .subscribe();
  }

  /* =========================================
     Auth buttons
  ========================================== */
  const loginBtn=document.getElementById('loginBtn');
  const logoutBtn=document.getElementById('logoutBtn');
  const profileBtn=document.getElementById('profileBtn');
  const mobileLoginBtn=document.getElementById('mobileLoginBtn');
  const mobileLogoutBtn=document.getElementById('mobileLogoutBtn');
  const mobileProfileBtn=document.getElementById('mobileProfileBtn');
  const authText=document.querySelector('#authStatus .auth-text');
  const mobileAuthText=document.getElementById('mobileAuthText');

  function updateAuthUI(session){
    const user=session?.user;
    if(user){
      if(authText) authText.textContent=user.email;
      if(mobileAuthText) mobileAuthText.textContent=user.email;

      loginBtn?.style.setProperty('display','none');
      logoutBtn?.style.setProperty('display','inline-flex');
      profileBtn?.style.setProperty('display','inline-flex');

      mobileLoginBtn?.style.setProperty('display','none');
      mobileLogoutBtn?.style.setProperty('display','inline-flex');
      mobileProfileBtn?.style.setProperty('display','inline-flex');

      profileBtn?.addEventListener('click',()=>window.location.href=`/views/pages/user/profile.html?id=${user.id}`);
      mobileProfileBtn?.addEventListener('click',()=>window.location.href=`/views/pages/user/profile.html?id=${user.id}`);
    } else {
      if(authText) authText.textContent='Guest';
      if(mobileAuthText) mobileAuthText.textContent='Guest';

      loginBtn?.style.setProperty('display','inline-flex');
      logoutBtn?.style.setProperty('display','none');
      profileBtn?.style.setProperty('display','none');

      mobileLoginBtn?.style.setProperty('display','inline-flex');
      mobileLogoutBtn?.style.setProperty('display','none');
      mobileProfileBtn?.style.setProperty('display','none');
    }
  }

  // Initial session check
  const { data } = await sb.auth.getSession();
  updateAuthUI(data.session);

  // Listen for auth changes
  sb.auth.onAuthStateChange((_event, session)=>{
    updateAuthUI(session);
  });

  // Login buttons redirect to login page
  loginBtn?.addEventListener('click', ()=> window.location.href='/views/pages/login.html');
  mobileLoginBtn?.addEventListener('click', ()=> window.location.href='/views/pages/login.html');

  // Logout buttons sign out via Supabase
  logoutBtn?.addEventListener('click', async ()=>{
    await sb.auth.signOut();
    updateAuthUI(null);
    window.location.href='/views/pages/login.html';
  });
  mobileLogoutBtn?.addEventListener('click', async ()=>{
    await sb.auth.signOut();
    updateAuthUI(null);
    window.location.href='/views/pages/login.html';
  });

  /* =========================================
     Toast notifications
  ========================================== */
  const toast = document.getElementById('toast');
  const toastText = document.getElementById('toastText');
  function showToast(message, ms=2500){
    toastText.textContent = message;
    toast.classList.add('show');
    setTimeout(()=> toast.classList.remove('show'), ms);
  }

  /* =========================================
     Mobile menu toggle
  ========================================== */
  const menuToggle = document.getElementById('menuToggle');
  const mobilePanel = document.getElementById('mobilePanel');
  menuToggle?.addEventListener('click', ()=>{
    const isOpen = mobilePanel.classList.toggle('open');
    menuToggle.setAttribute('aria-expanded', String(isOpen));
  });
  mobilePanel?.addEventListener('click', (e)=>{
    if(e.target.matches('a')) {
      mobilePanel.classList.remove('open');
      menuToggle.setAttribute('aria-expanded','false');
    }
  });

    const form = document.getElementById('resetForm');
    const statusMsg = document.getElementById('statusMsg');
    const sendBtn = document.getElementById('sendBtn');

    const confirmModal = document.getElementById('confirmModal');
    const confirmText = document.getElementById('confirmText');
    const closeModalBtn = document.getElementById('closeModal');
    const openMailBtn = document.getElementById('openMail');

    const LANDING_URL = '/index.html';
    const UPDATE_URL = '/views/pages/update-password.html'; // Your hosted password update page

    function setStatus(text, type='info'){
      if(!text){ statusMsg.style.display='none'; return; }
      statusMsg.textContent = text;
      statusMsg.className = `alert ${type}`;
      statusMsg.style.display = 'block';
    }

    // Modal helpers + focus trap
    function trapFocus(modal){
      const focusable = modal.querySelectorAll('a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])');
      const first = focusable[0];
      const last  = focusable[focusable.length-1];
      function keyHandler(e){
        if(e.key !== 'Tab') return;
        if(e.shiftKey){
          if(document.activeElement === first){ e.preventDefault(); last.focus(); }
        } else {
          if(document.activeElement === last){ e.preventDefault(); first.focus(); }
        }
      }
      modal.addEventListener('keydown', keyHandler);
      first && first.focus();
    }
    function openModal(m){ m.style.display='flex'; trapFocus(m); }
    function closeModal(m){ m.style.display='none'; }

    // Open mail provider helper (best-effort)
    function openMailClient(email){
      // Try opening common webmail providers or fallback to mailto
      const domain = (email.split('@')[1] || '').toLowerCase();
      if(domain.includes('gmail')) window.open('https://mail.google.com/', '_blank');
      else if(domain.includes('outlook') || domain.includes('hotmail') || domain.includes('live')) window.open('https://outlook.live.com/mail/0/', '_blank');
      else if(domain.includes('yahoo')) window.open('https://mail.yahoo.com/', '_blank');
      else window.location.href = `mailto:${email}`;
    }

    // Submit handler
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = document.getElementById('resetEmail').value.trim();
      if(!email){ setStatus('Please enter your email.','danger'); return; }

      // Disable button during request
      sendBtn.disabled = true; sendBtn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Sending...';

      try{
        const { error } = await sb.auth.resetPasswordForEmail(email, {
          redirectTo: window.location.origin + UPDATE_URL
        });
        if(error){ setStatus(error.message, 'danger'); }
        else{
          setStatus('');
          confirmText.textContent = `A reset link has been sent to ${email}. Please check your inbox and follow the instructions.`;
          openModal(confirmModal);
          form.reset();
        }
      }catch(err){
        setStatus('Something went wrong. Please try again.','danger');
      }finally{
        sendBtn.disabled = false; sendBtn.innerHTML = '<i class="fa fa-key"></i> Send Reset Link';
      }
    });

    // Modal buttons
    closeModalBtn.addEventListener('click', ()=> closeModal(confirmModal));
    confirmModal.addEventListener('click', (e)=>{ if(e.target===confirmModal) closeModal(confirmModal); });
    openMailBtn.addEventListener('click', ()=>{
      const email = document.getElementById('resetEmail').value.trim();
      if(email){ openMailClient(email); }
      closeModal(confirmModal);
    });

    // Session check: if already logged in, send to landing
    (async()=>{
      const { data:{ session } } = await sb.auth.getSession();
      if(session){
        window.location.href = LANDING_URL;
      }
    })();

    // Keyboard accessibility: Enter submits
    form.addEventListener('keydown', (e)=>{
      if(e.key==='Enter'){ e.preventDefault(); form.dispatchEvent(new Event('submit')); }
    });
  </script>
</body>
</html>
