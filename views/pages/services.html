<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Services — Elite Travel & Tour</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="Explore Elite Travel & Tour services including visa assistance, flight booking, tour packages, and Work & Pay programs."/>
  <link rel="stylesheet" href="/icons/fontawesome.min.css">
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/layout.css">
  <link rel="stylesheet" href="/css/components.css">
  <link rel="stylesheet" href="/css/pages.css">
  <link rel="stylesheet" href="/css/index.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- Standard ICO -->
<link rel="icon" href="/favicon.ico" type="image/x-icon">

<!-- Or PNG -->
<link rel="icon" href="/favicon.png" type="image/png">

<!-- Optional: SVG -->
<link rel="icon" href="/favicon.svg" type="image/svg+xml">
<style>
    :root{
      --chip-bg:#eef2ff;
      --chip-border:#c7d2fe;
    }

    .service-card__image-wrap{
      position:relative;
      height:160px;
      background:#f9fafb;
    }


    .service-card__ribbon{
      position:absolute;
      top:10px;
      left:-40px;
      transform:rotate(-35deg);
      background:rgba(245,158,11,.95);
      color:#111827;
      font-size:.7rem;
      text-transform:uppercase;
      letter-spacing:.08em;
      padding:.18rem 1.5rem;
      font-weight:700;
      box-shadow:0 8px 20px rgba(15,23,42,.35);
    }

    .service-card__plan-pill{
      position:absolute;
      bottom:8px;
      left:8px;
      border-radius:999px;
      padding:.2rem .55rem;
      font-size:.75rem;
      display:inline-flex;
      align-items:center;
      gap:.25rem;
      background:rgba(3,7,18,.85);
      color:#e5e7eb;
      backdrop-filter:blur(6px);
      border:1px solid rgba(148,163,184,.7);
    }

    .service-card__plan-pill i{
      font-size:.7rem;
      color:#fbbf24;
    }

    .service-card__body{
      padding:.7rem .8rem .75rem;
      display:flex;
      flex-direction:column;
      gap:.35rem;
      flex:1;
    }

    .service-card__title-row{
      display:flex;
      justify-content:space-between;
      gap:.5rem;
      align-items:flex-start;
    }

    .service-card__title{
      font-weight:700;
      font-size:.98rem;
      color:var(--brand);
    }

    .service-card__price{
      font-size:.78rem;
      padding:.15rem .55rem;
      border-radius:999px;
      background:#ecfdf5;
      color:#065f46;
      border:1px solid #a7f3d0;
      white-space:nowrap;
      display:inline-flex;
      align-items:center;
      gap:.25rem;
    }

    .service-card__price i{
      font-size:.7rem;
    }

    .service-card__desc{
      font-size:.86rem;
      color:var(--muted);
      min-height:2.6em;
    }

    .service-card__meta{
      display:flex;
      flex-wrap:wrap;
      gap:.3rem;
      margin-top:.15rem;
    }

    .service-card__meta-chip{
      font-size:.75rem;
      padding:.15rem .45rem;
      border-radius:999px;
      background:var(--chip-bg);
      border:1px solid var(--chip-border);
      color:#111827;
      display:inline-flex;
      align-items:center;
      gap:.25rem;
    }

    .service-card__meta-chip i{
      font-size:.7rem;
      color:#4f46e5;
    }

    .service-card__tags{
      display:flex;
      flex-wrap:wrap;
      gap:.25rem;
      margin-top:.1rem;
    }

    .service-card__tag{
      font-size:.7rem;
      padding:.1rem .4rem;
      border-radius:999px;
      background:#f9fafb;
      border:1px dashed #d1d5db;
      color:#4b5563;
    }

    .service-card__footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:.4rem;
      margin-top:.45rem;
      font-size:.78rem;
      color:#6b7280;
    }

    .service-card__link{
      display:inline-flex;
      align-items:center;
      gap:.25rem;
      color:var(--brand);
      font-weight:500;
      font-size:.78rem;
    }

    .service-card__link i{
      font-size:.7rem;
    }

    .fav-toggle{
      position:absolute;
      top:8px;
      right:8px;
      background:rgba(255,255,255,.94);
      border:1px solid #e5e7eb;
      border-radius:999px;
      padding:.3rem .55rem;
      display:flex;
      align-items:center;
      gap:.3rem;
      cursor:pointer;
      font-size:.78rem;
      color:#4b5563;
      box-shadow:0 10px 26px rgba(15,23,42,.28);
    }

    .fav-toggle i{
      color:#e11d48;
      font-size:.9rem;
    }

    .fav-toggle span.label{
      display:none;
    }

    @media(min-width:640px){
      .fav-toggle span.label{ display:inline; }
    }

    .fav-toggle[aria-pressed="true"]{
      background:#ffe4e6;
      border-color:#fb7185;
    }

    .fav-toggle[aria-pressed="true"] i{
      color:#be123c;
    }

    .filter-bar{
      display:flex;
      gap:.5rem;
      margin:1rem 0 .75rem;
      flex-wrap:wrap;
      align-items:center;
    }

    .filter-bar input.input{
      flex:1;
      min-width:190px;
    }

    .sorter{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      border:1px solid #e5e7eb;
      border-radius:8px;
      padding:.4rem .6rem;
      background:#fff;
    }

    .sorter label{
      font-size:.78rem;
      color:#6b7280;
    }

    .sorter select{
      border:none;
      font-size:.8rem;
      padding:.15rem .2rem;
      background:transparent;
      outline:none;
    }

    .categories{
      display:flex;
      gap:.5rem;
      flex-wrap:wrap;
      margin-bottom:1rem;
    }

    .categories .btn{
      white-space:nowrap;
      font-size:.8rem;
      padding:.3rem .7rem;
    }

    .categories .btn[data-cat].active{
      background:var(--brand);
      color:#fff;
      border-color:var(--brand);
    }

    .empty{
      background:#fff;
      border:1px dashed #d1d5db;
      border-radius:10px;
      padding:1rem;
      text-align:center;
      color:#6b7280;
      margin-top:1rem;
      font-size:.9rem;
    }

    .empty i{
      color:#a5b4fc;
      margin-right:.35rem;
    }

    .kpis{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
      gap:.7rem;
      margin:1rem 0 1.1rem;
    }

    .kpi{
      background:#fff;
      border-radius:10px;
      padding:.6rem .7rem;
      box-shadow:0 10px 24px rgba(15,23,42,.08);
      border:1px solid #e5e7eb;
      font-size:.82rem;
      color:#4b5563;
    }

    .kpi .val{
      font-size:1.25rem;
      font-weight:700;
      color:var(--brand-deep);
    }

    .cta-banner{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:.75rem;
      flex-wrap:wrap;
    }

    .faq-list{
      margin-top:.5rem;
      box-shadow: var(--shadow);
      transition: .3s;
    }

    .faq-list summary{
      cursor:pointer;
      padding:.35rem ;
      font-size:.9rem;
    }

    .faq-list p{
      font-size:.86rem;
      color: var(--light);
      margin:.2rem 0 .4rem;
      padding:.55rem;
      border-radius:5px;
    }

    .service-pill{
      display:inline-flex;
      align-items:center;
      gap:.25rem;
      padding:.18rem .55rem;
      border-radius:999px;
      background:#eff6ff;
      color:#1e3a8a;
      font-size:.75rem;
      border:1px solid #bfdbfe;
    }

    .service-pill i{
      font-size:.7rem;
    }

    .requirements{
      list-style:disc;
      margin:.2rem 0 .4rem 1.2rem;
      font-size:.86rem;
      color:#374151;
    }

    .requirements li{ margin-bottom:.12rem; }

    .toast{
      position:fixed;
      bottom:20px;
      left:50%;
      transform:translateX(-50%);
      background:#0b1120;
      color:#e5e7eb;
      padding:.75rem 1rem;
      border-radius:999px;
      box-shadow:0 16px 40px rgba(15,23,42,.85);
      z-index:2000;
      display:none;
      max-width:90vw;
      font-size:.85rem;
    }

    .toast.show{ display:flex; align-items:center; gap:.6rem; }
    .toast i{ color:#38bdf8; }

    .sr-only{
      position:absolute;
      width:1px;
      height:1px;
      padding:0;
      margin:-1px;
      overflow:hidden;
      clip:rect(0,0,0,0);
      border:0;
    }

    @media(max-width:600px){
      .service-card__image-wrap{ height:140px; }
    }
  </style>
</head>
<body>
  <nav aria-label="Primary">
    <div class="wrap">
      <a class="logo" href="/"><img src="/assets/logo/logo.png" alt="Elite Travel & Tour"></a>
      <ul class="primary">
        <li><a href="/views/pages/index.html"><i class="fa fa-house"></i> Home</a></li>
        <li><a href="/views/pages/services.html" class="active"><i class="fa fa-suitcase"></i> Services</a></li>
        <li><a href="/views/pages/work-and-pay.html"><i class="fa fa-briefcase"></i> Work & Pay</a></li>
        <li><a href="/views/pages/appointment.html"><i class="fa fa-calendar"></i> Book</a></li>
        <li><a href="/views/pages/contact.html"><i class="fa fa-envelope"></i> Contact</a></li>
        <li><a href="/views/pages/about.html"><i class="fa fa-circle-info"></i> About</a></li>
      </ul>
      <div class="nav-right">
        <button id="bellBtn" class="btn outline bell" aria-label="Notifications">
          <i class="fa-regular fa-bell"></i>
          <span id="bellCount" class="count hidden">0</span>
        </button>
        <span id="authStatus" class="auth-pill" style="display:none;">
          <i class="fa fa-user-check"></i><span class="auth-text">Guest</span>
        </span>
        <button id="loginBtn" class="btn outline"><i class="fa fa-right-to-bracket"></i> Login</button>
        <button id="profileBtn" class="btn outline" style="display:none"><i class="fa fa-user"></i></button>
        <button id="logoutBtn" class="btn outline" style="display:none"><i class="fa fa-right-from-bracket"></i> </button>
        <button id="menuToggle" class="menu-toggle" aria-expanded="false"><i class="fa fa-bars"></i></button>
      </div>
    </div>

    <!-- Mobile panel -->
    <div id="mobilePanel" class="mobile-panel">
      <div class="block">
        <a href="/views/pages/index.html"><i class="fa fa-house"></i> Home</a>
        <a href="/views/pages/services.html" class="active"><i class="fa fa-suitcase"></i> Services</a>
        <a href="/views/pages/work-and-pay.html"><i class="fa fa-briefcase"></i> Work & Pay</a>
        <a href="/views/pages/appointment.html"><i class="fa fa-calendar"></i> Book</a>
        <a href="/views/pages/contact.html"><i class="fa fa-envelope"></i> Contact</a>
        <a href="/views/pages/about.html"><i class="fa fa-circle-info"></i> About</a>
      </div>
      <div class="block">
        <span class="auth-pill"><i class="fa fa-user"></i><span id="mobileAuthText">Guest</span></span>
        <div class="toolbar">
          <button id="mobileLoginBtn" class="btn brand"><i class="fa fa-right-to-bracket"></i> Login</button>
          <button id="mobileProfileBtn" class="btn outline" style="display:none"><i class="fa fa-user"></i> Profile</button>
          <button id="mobileLogoutBtn" class="btn outline" style="display:none"><i class="fa fa-right-from-bracket"></i> Logout</button>
        </div>
      </div>
    </div>
  </nav>
 <div id="notifFeed" class="feed hidden">
  <div class="feed-toolbar">
    <span class="muted small-text">Notifications</span>
    <div style="color:var(--brand);display:flex;gap:.25rem;">
      <button id="markAllReadBtn" class='btn ' style="color:var(--brand);" ><i class="fa fa-check-double"></i> Mark as Read</button>
      <button id="clearAllNotifBtn" class='btn '><i class="fa fa-trash"></i> Clear</button>
    </div>
  </div>
  <div id="notifList" class="list"></div>
</div>
<script type="module" src="/src/js/notifications.js"></script>
  

  <main class="container">
    <h2 class="page-title">Services</h2>
    <p class="muted">
      Explore transparent, verified, and user-first services. Filter, search, preview, and book with confidence.
    </p>

    <!-- CTA banner -->
    <section class="card" style="background:#0b5ea8;color:#fff;">
      <div class="body cta-banner">
        <div>
          <h3 style="margin:0">Priority Express Available</h3>
          <p class="muted" style="color:#eaf4ff;margin:.35rem 0 0;">
            Get priority handling for urgent travel needs. Available for logged-in users.
          </p>
        </div>
        <div class="toolbar">
          <a href="/views/pages/services.html#express" class="btn brand" style="background:#fff;color:#0b5ea8">
            <i class="fa fa-bolt"></i> Get Express
          </a>
          <a href="/views/pages/appointment.html" class="btn outline" style="border-color:#eaf4ff;color:#fff">
            <i class="fa fa-calendar"></i> Book a consult
          </a>
        </div>
      </div>
    </section>

    <!-- KPIs -->
    <section class="kpis" aria-label="Service metrics">
      <div class="kpi"><div class="val">3+</div><div>Countries served</div></div>
      <div class="kpi"><div class="val">4.8</div><div>Average rating</div></div>
      <div class="kpi"><div class="val">24/7</div><div>Support coverage</div></div>
      <div class="kpi"><div class="val">100%</div><div>Verified partners</div></div>
    </section>

    <!-- Filter/Search Bar -->
    <div class="filter-bar" role="search">
      <input class="input" id="searchInput" placeholder="Search services... (e.g., visa, work & pay, flight)" aria-label="Search services">
      <button class="btn outline" id="searchBtn" aria-label="Search"><i class="fa fa-search"></i> Search</button>
      <button class="btn outline" id="clearBtn" aria-label="Clear search"><i class="fa fa-times"></i> Clear</button>
      <div class="sorter">
        <label for="sortSelect">Sort:</label>
        <select id="sortSelect">
          <option value="created_desc">Newest</option>
          <option value="created_asc">Oldest</option>
          <option value="title_asc">Title A–Z</option>
          <option value="title_desc">Title Z–A</option>
        </select>
      </div>
    </div>

    <!-- Categories -->
    <div class="categories" role="tablist" aria-label="Filter by category">
      <button class="btn outline active" data-cat="all" aria-selected="true">All</button>
      <button class="btn outline" data-cat="visa">Visa</button>
      <button class="btn outline" data-cat="flights">Flights</button>
      <button class="btn outline" data-cat="tours">Tours</button>
      <button class="btn outline" data-cat="work">Work & Pay</button>
      <button class="btn outline" data-cat="express">Express</button>
    </div>

    <!-- Services Grid (dynamic only) -->
    <section class="services-grid" id="servicesGrid" aria-live="polite">
      <!-- dynamic cards injected here -->
    </section>

    <!-- Empty state -->
    <div id="emptyState" class="empty" style="display:none">
      <i class="fa fa-circle-info"></i> No services found. Try a different search or category.
    </div>

    <!-- Quick Info Modal -->
    <div class="modal" id="infoModal" role="dialog" aria-modal="true" aria-labelledby="infoTitle">
      <section class="card">
        <div class="body">
          <div class="header">
            <h3 id="infoTitle">Service</h3>
            <button class="btn ghost" id="closeInfo" type="button"><i class="fa fa-times"></i></button>
          </div>
          <div class="content">
            <div class="row" style="display:flex;flex-wrap:wrap;gap:.35rem;margin-bottom:.35rem;">
              <span class="service-pill" id="infoCategory"><i class="fa fa-tag"></i> Category</span>
              <span class="service-pill" id="infoPlan"><i class="fa fa-bolt"></i> Plan</span>
              <span class="service-pill" id="infoStatus"><i class="fa fa-shield-check"></i> Status</span>
              <span class="service-pill" id="infoPosted"><i class="fa fa-clock"></i> Created</span>
            </div>
            <p id="infoDesc" class="muted"></p>
            <div id="infoRequirements"></div>
          </div>
          <div class="footer" style="display:flex;justify-content:space-between;gap:.5rem;flex-wrap:wrap;margin-top:.5rem;">
            <a id="infoLink" class="btn brand" href="#"><i class="fa fa-arrow-right"></i> View details</a>
            <a id="infoExpress" class="btn outline" href="#express"><i class="fa fa-bolt"></i> Express priority</a>
          </div>
        </div>
      </section>
    </div>

    <!-- Help/FAQ -->
    <section class="card" style="margin-top:1rem;">
      <div class="body">
        <h3 class="section-title">FAQs and service policies</h3>
        <details class="accordion faq-list">
          <summary><strong>How do I book an appointment?</strong></summary>
          <p>Use the Book page to schedule a consultation. Logged‑in users can access priority options.</p>
        </details>
        <details class="accordion faq-list">
          <summary><strong>Are payments secure?</strong></summary>
          <p>Yes. We use verified payment gateways and never store your card details on our servers.</p>
        </details>
        <details class="accordion faq-list">
          <summary><strong>Can I change my flight after booking?</strong></summary>
          <p>Most bookings support changes, subject to airline policy and fees. We’ll guide you through options.</p>
        </details>
        <details class="accordion faq-list">
          <summary><strong>What documents are required for visa assistance?</strong></summary>
          <p>Typically a valid passport, financial statements, and supporting documents. Requirements vary by country.</p>
        </details>
        <details class="accordion faq-list">
          <summary><strong>Do you offer group discounts for tours?</strong></summary>
          <p>Yes, group rates are available depending on destination and season.</p>
        </details>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer id="footer">
    <div class="grid">
      <div>
        <h4>Elite Travel & Tour</h4>
        <p>Trusted partner for seamless journeys worldwide.</p>
        <p class="muted">Visa assistance, Work & Pay programs, and flight bookings with premium support.</p>
      </div>
      <div>
        <h4>Quick Links</h4>
        <ul>
          <li><a href="/views/pages/services.html">Services</a></li>
          <li><a href="/views/pages/work-and-pay.html">Work & Pay</a></li>
          <li><a href="/views/pages/appointment.html">Book Appointment</a></li>
          <li><a href="/views/pages/contact.html">Contact</a></li>
          <li><a href="/views/pages/about.html">About</a></li>
        </ul>
      </div>
      <div>
        <h4>Contact</h4>
        <p><i class="fa fa-phone"></i> +233 59 911 7007</p>
        <p><i class="fa fa-envelope"></i> info@elitetravel.com</p>
        <p><i class="fa fa-map-marker-alt"></i> Adabraka Akasanoma rd, Greater Accra, Ghana</p>
        <div class="newsletter">
          <label for="newsletterEmail" class="muted">Subscribe to our newsletter:</label><br>
          <input id="newsletterEmail" type="email" placeholder="Your email">
          <button id="subscribeBtn"><i class="fa fa-paper-plane"></i> Subscribe</button>
        </div>
        <div id="subscribeMsg" class="muted" style="margin-top:.5rem;"></div>
      </div>
      <div>
        <h4>Resources</h4>
        <ul class="list">
          <li><a href="/views/pages/profile.html">Profile</a></li>
          <li><a href="/views/pages/tracking.html">Tracking</a></li>
          <li><a href="/views/pages/privacy.html">Privacy Policy</a></li>
          <li><a href="/views/pages/terms.html">Terms of Service</a></li>
        </ul>
      </div>
      <div class="social">
        <h4>Follow Us</h4>
        <div class="toolbar">
          <a href="#"><i class="fa-brands fa-facebook"></i></a>
          <a href="#"><i class="fa-brands fa-x-twitter"></i></a>
          <a href="#"><i class="fa-brands fa-instagram"></i></a>
          <a href="#"><i class="fa-brands fa-linkedin"></i></a>
        </div>
      </div>
    </div>
    <div class="footer-bottom">© <span id="year"></span> Elite Travel & Tour. All rights reserved.</div>
  </footer>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"><i class="fa fa-info-circle"></i><span id="toastText">Notice</span></div>

  <!-- Scripts -->
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script type="module" src="/src/js/supabase.js"></script>
  <script type="module">
    import { sb } from '/src/js/supabase.js';

    let currentUser=null;

    // Footer year + newsletter
    document.getElementById('year').textContent=new Date().getFullYear();
    const subscribeBtn=document.getElementById('subscribeBtn');
    const eemailInput=document.getElementById('newsletterEmail');
    const subscribeMsg=document.getElementById('subscribeMsg');
    subscribeBtn?.addEventListener('click',()=>{
      const eemail=eemailInput.value.trim();
      if(!eemail){
        subscribeMsg.textContent="Please enter your email.";
        subscribeMsg.style.color="red";
        return;
      }
      subscribeMsg.textContent=`Thank you for subscribing, ${eemail}!`;
      subscribeMsg.style.color="lightgreen";
      eemailInput.value="";
    });

    // Toast
    const toast=document.getElementById('toast');
    const toastText=document.getElementById('toastText');
    function showToast(message,ms=2500){
      if(!toast || !toastText) return;
      toastText.textContent=message;
      toast.classList.add('show');
      setTimeout(()=> toast.classList.remove('show'),ms);
    }

    // Notification feed toggle
    document.addEventListener('click',(e)=>{
      const feed=document.getElementById('notifFeed');
      if(!feed) return;
      if(e.target.closest('#bellBtn')){
        feed.classList.toggle('hidden');
      }else if(!e.target.closest('#notifFeed')){
        feed.classList.add('hidden');
      }
    });

    // Supabase notifications subscription
    function renderNotification(n){
      const list=document.getElementById('notifList');
      const bellCount=document.getElementById('bellCount');
      if(list){
        const el=document.createElement('div');
        el.className='item';
        el.textContent=n.message || n.text;
        list.prepend(el);
      }
      if(bellCount){
        const count=parseInt(bellCount.textContent||'0',10)+1;
        bellCount.textContent=String(count);
        bellCount.classList.remove('hidden');
      }
    }

    let notifChannel=null;
    async function subscribeNotifications(userId){
      if(notifChannel){
        await sb.removeChannel(notifChannel);
        notifChannel=null;
      }
      notifChannel=sb.channel(`header-notifs-${userId}`)
        .on('postgres_changes',{
          event:'INSERT',
          schema:'public',
          table:'notifications',
          filter:`user_id=eq.${userId}`
        },payload=>{
          renderNotification(payload.new);
        })
        .subscribe();
    }

    // Auth buttons
    const loginBtn=document.getElementById('loginBtn');
    const logoutBtn=document.getElementById('logoutBtn');
    const profileBtn=document.getElementById('profileBtn');
    const mobileLoginBtn=document.getElementById('mobileLoginBtn');
    const mobileLogoutBtn=document.getElementById('mobileLogoutBtn');
    const mobileProfileBtn=document.getElementById('mobileProfileBtn');
    const authText=document.querySelector('#authStatus .auth-text');
    const mobileAuthText=document.getElementById('mobileAuthText');

    function updateAuthUI(session){
      const user=session?.user;
      currentUser=user || null;

      if(user){
        if(authText) authText.textContent=user.email;
        document.getElementById('authStatus')?.style.setProperty('display','none');
        if(mobileAuthText) mobileAuthText.textContent=user.email;

        loginBtn?.style.setProperty('display','none');
        logoutBtn?.style.setProperty('display','inline-flex');
        profileBtn?.style.setProperty('display','inline-flex');

        mobileLoginBtn?.style.setProperty('display','none');
        mobileLogoutBtn?.style.setProperty('display','inline-flex');
        mobileProfileBtn?.style.setProperty('display','inline-flex');

        profileBtn.onclick=()=> window.location.href=`/views/pages/user/profile.html?id=${user.id}`;
        mobileProfileBtn.onclick=()=> window.location.href=`/views/pages/user/profile.html?id=${user.id}`;

        subscribeNotifications(user.id);
      }else{
        if(authText) authText.textContent='Guest';
        document.getElementById('authStatus')?.style.setProperty('display','none');
        if(mobileAuthText) mobileAuthText.textContent='Guest';

        loginBtn?.style.setProperty('display','inline-flex');
        logoutBtn?.style.setProperty('display','none');
        profileBtn?.style.setProperty('display','none');

        mobileLoginBtn?.style.setProperty('display','inline-flex');
        mobileLogoutBtn?.style.setProperty('display','none');
        mobileProfileBtn?.style.setProperty('display','none');
      }
    }

    {
      const { data }=await sb.auth.getSession();
      updateAuthUI(data.session);
    }
    sb.auth.onAuthStateChange((_event,session)=> updateAuthUI(session));

    loginBtn?.addEventListener('click',()=> window.location.href='/views/pages/login.html');
    mobileLoginBtn?.addEventListener('click',()=> window.location.href='/views/pages/login.html');

    logoutBtn?.addEventListener('click',async()=>{
      await sb.auth.signOut();
      updateAuthUI(null);
      window.location.href='/views/pages/login.html';
    });
    mobileLogoutBtn?.addEventListener('click',async()=>{
      await sb.auth.signOut();
      updateAuthUI(null);
      window.location.href='/views/pages/login.html';
    });

    // Mobile menu
    const menuToggle=document.getElementById('menuToggle');
    const mobilePanel=document.getElementById('mobilePanel');
    menuToggle?.addEventListener('click',()=>{
      const isOpen=mobilePanel.classList.toggle('open');
      menuToggle.setAttribute('aria-expanded',String(isOpen));
    });
    mobilePanel?.addEventListener('click',(e)=>{
      if(e.target.matches('a')){
        mobilePanel.classList.remove('open');
        menuToggle.setAttribute('aria-expanded','false');
      }
    });

    // Services state and DOM references
    const searchInput=document.getElementById('searchInput');
    const searchBtn=document.getElementById('searchBtn');
    const clearBtn=document.getElementById('clearBtn');
    const sortSelect=document.getElementById('sortSelect');
    const servicesGrid=document.getElementById('servicesGrid');
    const emptyState=document.getElementById('emptyState');

    const infoModal=document.getElementById('infoModal');
    const infoTitle=document.getElementById('infoTitle');
    const infoDesc=document.getElementById('infoDesc');
    const infoLink=document.getElementById('infoLink');
    const infoExpress=document.getElementById('infoExpress');
    const closeInfo=document.getElementById('closeInfo');
    const infoCategory=document.getElementById('infoCategory');
    const infoPlan=document.getElementById('infoPlan');
    const infoStatus=document.getElementById('infoStatus');
    const infoPosted=document.getElementById('infoPosted');
    const infoRequirements=document.getElementById('infoRequirements');

    let allServices=[];   // dynamic services from Supabase
    let filtered=[];
    let currentCat='all';
    let servicesChannel=null;

    // Debounce helper
    function debounce(fn,delay=250){
      let t=null;
      return(...args)=>{
        clearTimeout(t);
        t=setTimeout(()=>fn(...args),delay);
      };
    }

    // Normalize service from DB row (using metadata where available)
    function normalizeService(row){
      const m=row.metadata || {};

      const banner =
        m.banner ||
        m.image_url ||
        row.banner ||
        '/assets/services/default.jpg';

      const price =
        row.price != null ? Number(row.price) :
        m.price_amount != null ? Number(m.price_amount) : null;

      const price_label =
        m.price_label ||
        (price != null ? `GHS ${price.toLocaleString()}` : 'From consult');

      const tags = Array.isArray(row.tags)
        ? row.tags
        : Array.isArray(m.tags)
          ? m.tags
          : (m.tags || []);

      const requirements = Array.isArray(m.requirements)
        ? m.requirements
        : (m.requirements || []);

      return {
        id:row.id,
        title:row.title,
        slug:row.slug,
        category:(row.category || m.category || 'misc').toLowerCase(),
        plan:row.plan || m.plan || null,
        status:row.status || 'draft',
        description:row.short_desc || row.description || m.short_desc || '',
        full_desc:row.full_desc || m.full_desc || row.description || '',
        banner,
        price,
        price_label,
        tags,
        requirements,
        created_at:row.created_at || m.created_at || null
      };
    }

    function formatPrice(svc){
      if(svc.price != null){
        const v = Number(svc.price);
        if(!isNaN(v)){
          return `GHS ${v.toLocaleString()}`;
        }
      }
      if(svc.price_label) return svc.price_label;
      return 'From consult';
    }

    // Dynamic service card template
    function serviceCardTemplate(s){
      const href=s.slug ? `/views/pages/service-detail.html?slug=${encodeURIComponent(s.slug)}` : '#';
      const isActive=s.status==='active';
      const isComingSoon=s.status==='draft' || s.status==='inactive';
      const planLabel=s.plan==='work'?'Work & Pay':s.plan==='express'?'Express':null;
      const priceText=formatPrice(s);

      return `
        <a class="card service-card dynamic" data-cat="${s.category}" href="${href}">
          <div class="service-card__image-wrap">
            <img src="${s.banner}" alt="${s.title}">
            <button class="fav-toggle" data-slug="${s.slug || s.id}" type="button">
              <i class="fa fa-heart"></i><span class="label">Favorite</span>
            </button>
            ${planLabel ? `
              <span class="service-card__plan-pill">
                <i class="fa ${s.plan==='work'?'fa-briefcase':'fa-bolt'}"></i> ${planLabel}
              </span>` : ''}
            ${isComingSoon ? `<div class="service-card__ribbon">Coming soon</div>` : ''}
          </div>
          <div class="service-card__body">
            <div class="service-card__title-row">
              <span class="service-card__title">${s.title}</span>
              <span class="service-card__price"><i class="fa fa-coins"></i> ${priceText}</span>
            </div>
            <p class="service-card__desc">${s.description || ''}</p>
            <div class="service-card__meta">
              <span class="service-card__meta-chip">
                <i class="fa fa-tag"></i> ${s.category || '—'}
              </span>
              <span class="service-card__meta-chip">
                <i class="fa fa-clock"></i> ${s.created_at ? new Date(s.created_at).toLocaleDateString() : '—'}
              </span>
            </div>
            <div class="service-card__tags">
              ${s.tags.map(t=>`<span class="service-card__tag">${t}</span>`).join('')}
            </div>
            <div class="service-card__footer">
              <span><i class="fa fa-shield"></i> ${isActive?'Available':'Preview'}</span>
              <span class="service-card__link">View details <i class="fa fa-arrow-right"></i></span>
            </div>
          </div>
        </a>
      `;
    }

    // Render dynamic services
    function renderDynamicServices(list){
      servicesGrid.querySelectorAll('.service-card.dynamic').forEach(n=> n.remove());

      if(!list.length){
        emptyState.style.display='block';
      }else{
        emptyState.style.display='none';
      }

      const frag=document.createElement('div');
      frag.innerHTML=list.map(serviceCardTemplate).join('');
      servicesGrid.append(...frag.children);

      // Favorites toggle
      servicesGrid.querySelectorAll('.fav-toggle').forEach(btn=>{
        btn.addEventListener('click',(e)=>{
          e.preventDefault();
          e.stopPropagation();
          const slug=btn.dataset.slug;
          if(!slug) return;
          const favs=JSON.parse(localStorage.getItem('elite.services.favorites')||'[]');
          const idx=favs.indexOf(slug);
          if(idx>-1){
            favs.splice(idx,1);
            btn.querySelector('i').classList.remove('fa-solid');
            btn.setAttribute('aria-pressed','false');
            showToast('Removed from favorites');
          }else{
            favs.push(slug);
            btn.querySelector('i').classList.add('fa-solid');
            btn.setAttribute('aria-pressed','true');
            showToast('Added to favorites');
          }
          localStorage.setItem('elite.services.favorites',JSON.stringify(favs));
        });
      });

      // Info modal preview if href '#'
      servicesGrid.querySelectorAll('.service-card.dynamic').forEach(card=>{
        card.addEventListener('click',(e)=>{
          if(e.target.closest('.fav-toggle')) return;
          const href=card.getAttribute('href');
          if(href==='#'){
            e.preventDefault();
            const slug=card.querySelector('.fav-toggle')?.dataset.slug;
            const svc=allServices.find(x=>(x.slug || x.id)===(slug));
            openInfoModal(svc || null);
          }
        });
      });

      renderFavStates();
    }

    // Fetch services from Supabase
    async function fetchServices(){
      try{
        const { data,error }=await sb
          .from('services')
          .select('id,title,slug,category,plan,status,description,short_desc,full_desc,metadata,price,tags,created_at')
          .neq('status','deleted')
          .order('created_at',{ ascending:false })
          .limit(200);
        if(error){
          console.error('fetch services error',error);
          return [];
        }
        return (data||[]).map(normalizeService);
      }catch(e){
        console.error(e);
        return [];
      }
    }

    // Open info modal
    function openInfoModal(svc){
      if(!svc){
        infoTitle.textContent='Service';
        infoDesc.textContent='No details available.';
        infoLink.href='#';
        infoCategory.innerHTML='<i class="fa fa-tag"></i> —';
        infoPlan.innerHTML='<i class="fa fa-bolt"></i> —';
        infoStatus.innerHTML='<i class="fa fa-shield"></i> —';
        infoPosted.innerHTML='<i class="fa fa-clock"></i> —';
        infoRequirements.innerHTML='';
        infoModal.classList.add('open');
        trapFocus(infoModal);
        return;
      }

      infoTitle.textContent=svc.title || 'Service';
      infoDesc.textContent=svc.full_desc || svc.description || '—';
      infoLink.href=svc.slug ? `/views/pages/service-detail.html?slug=${encodeURIComponent(svc.slug)}` : '#';

      const planLabel=svc.plan==='work'?'Work & Pay':svc.plan==='express'?'Express':'Standard';
      infoCategory.innerHTML=`<i class="fa fa-tag"></i> ${svc.category || '—'}`;
      infoPlan.innerHTML=`<i class="fa fa-bolt"></i> ${planLabel}`;
      infoStatus.innerHTML=svc.status==='active'
        ? `<i class="fa fa-shield-check"></i> Active`
        : `<i class="fa fa-circle-info"></i> ${svc.status || 'Draft'}`;
      infoPosted.innerHTML=`<i class="fa fa-clock"></i> ${svc.created_at ? new Date(svc.created_at).toLocaleDateString() : '—'}`;

      const reqs=Array.isArray(svc.requirements)?svc.requirements:[];
      infoRequirements.innerHTML=reqs.length
        ? `<h4 class="section-title" style="margin:.5rem 0;">Requirements</h4><ul class="requirements">${reqs.map(r=>`<li>${r}</li>`).join('')}</ul>`
        : '';

      infoExpress.href='#express';
      infoExpress.title='Express: applicant bears costs; gains priority handling and partner offer benefits.';

      infoModal.classList.add('open');
      trapFocus(infoModal);
    }

    closeInfo.addEventListener('click',()=> infoModal.classList.remove('open'));
    infoModal.addEventListener('click',(e)=>{ if(e.target===infoModal) infoModal.classList.remove('open'); });

    // Focus trap for modal
    function trapFocus(modal){
      const focusable=modal.querySelectorAll('a[href],button,textarea,input,select,[tabindex]:not([tabindex="-1"])');
      if(!focusable.length) return;
      const first=focusable[0];
      const last=focusable[focusable.length-1];
      function keyHandler(e){
        if(e.key!=='Tab') return;
        if(e.shiftKey){
          if(document.activeElement===first){
            e.preventDefault();
            last.focus();
          }
        }else{
          if(document.activeElement===last){
            e.preventDefault();
            first.focus();
          }
        }
      }
      modal.addEventListener('keydown',keyHandler);
      first.focus();
    }

    // Search
    function applySearch(term){
      const normalized=term.trim().toLowerCase();
      const base=allServices.slice();
      filtered=base.filter(s=>{
        return (s.title?.toLowerCase().includes(normalized))
          || (s.category?.toLowerCase().includes(normalized))
          || (s.description?.toLowerCase().includes(normalized))
          || (s.full_desc?.toLowerCase().includes(normalized));
      });
      renderDynamicServices(applyCategory(filtered));
      saveState(currentCat,term);
      announceVisibleCount();
    }

    searchBtn.addEventListener('click',()=> applySearch(searchInput.value));
    clearBtn.addEventListener('click',()=>{
      searchInput.value='';
      filtered=allServices.slice();
      renderDynamicServices(applyCategory(filtered));
      saveState(currentCat,'');
      announceVisibleCount();
    });

    searchInput.addEventListener('input',debounce(e=> applySearch(e.target.value),180));
    searchInput.addEventListener('keydown',(e)=>{
      if(e.key==='Enter'){
        e.preventDefault();
        applySearch(searchInput.value);
      }
    });

    // Category filter
    const categoryButtons=document.querySelectorAll('.categories [data-cat]');
    categoryButtons.forEach(btn=>{
      btn.addEventListener('click',()=>{
        categoryButtons.forEach(b=> b.classList.remove('active'));
        btn.classList.add('active');
        categoryButtons.forEach(b=> b.setAttribute('aria-selected','false'));
        btn.setAttribute('aria-selected','true');
        currentCat=btn.dataset.cat;
        const base=filtered.length ? filtered : allServices.slice();
        renderDynamicServices(applyCategory(base));
        saveState(currentCat,searchInput.value.trim());
        announceVisibleCount();
      });
    });

    function applyCategory(list){
      if(currentCat==='all') return sortList(list);
      return sortList(list.filter(s=>{
        if(currentCat==='express') return s.plan==='express';
        if(currentCat==='work') return s.plan==='work';
        return s.category===currentCat;
      }));
    }

    // Sort
    sortSelect.addEventListener('change',()=>{
      const base=filtered.length ? filtered : allServices.slice();
      renderDynamicServices(applyCategory(base));
      announceVisibleCount();
    });

    function sortList(list){
      const val=sortSelect.value;
      const sorted=list.slice();
      if(val==='created_desc'){
        sorted.sort((a,b)=> new Date(b.created_at||0) - new Date(a.created_at||0));
      }else if(val==='created_asc'){
        sorted.sort((a,b)=> new Date(a.created_at||0) - new Date(b.created_at||0));
      }else if(val==='title_asc'){
        sorted.sort((a,b)=> String(a.title||'').localeCompare(String(b.title||'')));
      }else if(val==='title_desc'){
        sorted.sort((a,b)=> String(b.title||'').localeCompare(String(a.title||'')));
      }
      return sorted;
    }

    // Persistent UI state
    const stateKey='elite.services.state';
    function saveState(cat,term){
      localStorage.setItem(stateKey,JSON.stringify({ cat,term }));
    }
    function loadState(){
      try{
        const s=JSON.parse(localStorage.getItem(stateKey)||'{}');
        if(s.term){ searchInput.value=s.term; }
        if(s.cat){
          currentCat=s.cat;
          categoryButtons.forEach(b=>{
            const active=b.dataset.cat===s.cat;
            b.classList.toggle('active',active);
            b.setAttribute('aria-selected',String(active));
          });
        }
      }catch(e){}
    }

    // Accessible count announcement
    function announceVisibleCount(){
      const visible=servicesGrid.querySelectorAll('.service-card.dynamic').length;
      const sr=document.createElement('div');
      sr.className='sr-only';
      sr.textContent=`${visible} dynamic service${visible===1?'':'s'} visible`;
      document.body.appendChild(sr);
      setTimeout(()=> sr.remove(),600);
    }

    // Favorites initial render
    function renderFavStates(){
      const favs=JSON.parse(localStorage.getItem('elite.services.favorites')||'[]');
      document.querySelectorAll('.fav-toggle').forEach(ft=>{
        const slug=ft.dataset.slug;
        const active=favs.includes(slug);
        ft.querySelector('i').classList.toggle('fa-solid',active);
        ft.setAttribute('aria-pressed',String(active));
        ft.title=active ? 'Favorited' : 'Favorite';
      });
    }

    // Load services
    async function loadServices(){
      const data=await fetchServices();
      allServices=data;
      filtered=allServices.slice();
      loadState();
      renderDynamicServices(applyCategory(filtered));
      renderFavStates();
      announceVisibleCount();
    }
    await loadServices();

    // Realtime subscription
    function subscribeServices(){
      if(servicesChannel){
        sb.removeChannel(servicesChannel);
        servicesChannel=null;
      }
      servicesChannel=sb.channel('services-stream')
        .on('postgres_changes',{
          event:'INSERT',
          schema:'public',
          table:'services'
        },payload=>{
          const normalized=normalizeService(payload.new);
          const exists=allServices.some(x=> String(x.id)===String(normalized.id));
          if(!exists){
            allServices.unshift(normalized);
            filtered=allServices.slice();
            renderDynamicServices(applyCategory(filtered));
            showToast('New service added.');
            announceVisibleCount();
          }
        })
        .on('postgres_changes',{
          event:'UPDATE',
          schema:'public',
          table:'services'
        },payload=>{
          const normalized=normalizeService(payload.new);
          const idx=allServices.findIndex(x=> String(x.id)===String(normalized.id));
          if(idx>-1){
            allServices[idx]=normalized;
            filtered=allServices.slice();
            renderDynamicServices(applyCategory(filtered));
            showToast('Service updated.');
            announceVisibleCount();
          }
        })
        .subscribe();
    }
    subscribeServices();

    // Express policy toast
    if(location.hash==='#express'){
      showToast('Express: applicant bears costs; prioritized handling and partner offer benefits included.');
    }

    // There are no static hero favorites anymore, but keep safety call
    renderFavStates();
  </script>
</body>
</html>
